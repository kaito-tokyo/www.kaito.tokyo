- SetConstants:
    assign:
      - endpoints: '${sys.get_env("ENDPOINTS")}'
      - channelId: '${sys.get_env("CHANNEL_ID")}'
      - cacheBucketName: '${sys.get_env("CACHE_BUCKET_NAME")}'
      - metadataBucketName: '${sys.get_env("METADATA_BUCKET_NAME")}'
      - today: '${text.split(time.format(sys.now()), "T")[0]}'
      - cachedSearchListObject: '${channelId + "/save-search-list/" + today + ".json"}'
      - metadataSearchListDirectory: '${channelId + "/search"}'
- SaveSearchList:
    call: "http.get"
    args:
      url: "${endpoints.saveSearchList}"
      query:
        channelId: "${channelId}"
        outputBucket: "${cacheBucketName}"
        outputObject: "${cachedSearchListObject}"
      auth:
        type: "OIDC"
- SplitSearchList:
    call: "http.get"
    args:
      url: "${endpoints.splitSearchList}"
      query:
        inputBucket: "${cacheBucketName}"
        inputObject: "${cachedSearchListObject}"
        outputBucket: "${metadataBucketName}"
        outputDirectory: "${metadataSearchListDirectory}"
      auth:
        type: "OIDC"
