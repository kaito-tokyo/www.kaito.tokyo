- AssignConstants:
    assign:
      - channelId: "UCfhyVWrxCmdUpst-5n7Kz_Q"
      - cacheBucketName: "www-kaito-tokyo-youtube-fetcher-caches"
- CalculateCachedObjectName:
    assign:
      - today: '${text.split(time.format(sys.now()), "T")[0]}'
      - cachedObjectName: '${channelId + "/" + today + ".json"}'
- GetCachedResponse:
    call: googleapis.storage.v1.objects.get
    args:
      bucket: "${cacheBucketName}"
      object: "${cachedObjectName}"
    result: cachedResponse
# - youtube_video_fetcher:
#     call: "http.get"
#     args:
#       url: "https://asia-east1-www-kaito-tokyo.cloudfunctions.net/youtube-video-fetcher"
#       query:
#         channelId: "${channelId}"
#       auth:
#         type: "OIDC"
#     result: youtube_video_fetcher_result
- return_result:
    return: "${cachedResponse}"
