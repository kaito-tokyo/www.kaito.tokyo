- SetConstants:
    assign:
      - channelId: '${sys.get_env("CHANNEL_ID")}'
      - cacheBucketName: '${sys.get_env("CACHE_BUCKET_NAME")}'
      - metadataBucketName: '${sys.get_env("METADATA_BUCKET_NAME")}'
      - today: '${text.split(time.format(sys.now()), "T")[0]}'
      - cachedSearchListObject: '${channelId + "/youtube-search-list/" + today + ".json"}'
      - metadataSearchListDirectory: '${channelId + "/youtube-search-list"}'
- SaveSearchList:
    call: "http.get"
    args:
      url: "https://asia-east1-www-kaito-tokyo.cloudfunctions.net/youtube-fetcher-save-search-list"
      query:
        channelId: "${channelId}"
        outputBucket: "${cacheBucketName}"
        outputObject: "${cachedSearchListObject}"
      auth:
        type: "OIDC"
- SplitSearchList:
    call: "http.get"
    args:
      url: "https://asia-east1-www-kaito-tokyo.cloudfunctions.net/youtube-fetcher-split-search-list"
      query:
        inputBucket: "${cacheBucketName}"
        inputObject: "${cachedSearchListObject}"
        outputBucket: "${metadataBucketName}"
        outputDirectory: "${metadataSearchListDirectory}"
      auth:
        type: "OIDC"
