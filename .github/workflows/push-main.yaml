name: "push-main"

on:
  push:
    branches:
      - "main"
  pull_request:
    branches:
      - "main"

jobs:
  PublishImageYouTubeFetcher:
    uses: "./.github/workflows/publish-image.yaml"
    permissions:
      contents: "read"
      id-token: "write"
    with:
      repository: "asia-east1-docker.pkg.dev/www-kaito-tokyo-1-svc-my1a/yf-main/yf-main"

  ApplyTerraformMain:
    needs:
      - "ImagePublishMain"
    uses: "./.github/workflows/apply-terraform-main.yaml"
    permissions:
      contents: "read"
      id-token: "write"
    with:
      run-image: "${{ needs.PublishImageYouTubeFetcher.outputs.run-image }}"
